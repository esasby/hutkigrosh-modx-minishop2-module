## Модуль интеграции с CMS Modx Revlution с корзиной Minishop2

Данный модуль обеспечивает взаимодействие между интернет-магазином на базе CMS Modx Revlution (+ Minishop2) и сервисом платежей [ХуткiГрош](https://hutkigrosh.by)
  
### Инструкция по установке:
1. Создайте резервную копию вашего магазина и базы данных
2. Загрузите архив с модулем [msphutkigrosh-2.0.0-pl.transport.zip](https://github.com/esasby/hutkigrosh-modx-minishop2-module/raw/main/msphutkigrosh-2.0.0-pl.transport.zip)
3. В административной части Modx выберите `Приложения — Установщик — Загрузить дополнения — Загрузить пакет`. Выберите архив и нажмите `Установить`.
4. Перейдите в меню `Приложения — miniShop2 — Настройки - Способы оплаты`.
5. При необходимости добавьте новый способ оплаты с именем ХуткiГрош (Hutkigrosh). Если он уже существует, сделайте активным и назначьте способ доставки
6. Добавьте новый ресурс Modx (для успешной оплаты )
    * Заголовок - `Успешная оплата`
    * Шаблон - Ваш стандартный шаблон
    * Содержимое - `[[!msHutkigroshSuccess]]`
7. Добавьте новый ресурс Modx (для неуспешной оплаты )
    * Заголовок - `Неуспешная оплата`
    * Шаблон - Ваш стандартный шаблон
    * Содержимое - Любой текст      
8. Перейдите в меню `Системные настройки` Modx и выберите категорию параметров `minishop2` (фильтр по ключу параметра `ms2_msphutkigrosh%`) 
9. Заполните параметры для идентификации вашего магазина в системе ХуткiГрош
   * Режим песочницы - перевод модуля в тестовый режим работы
   * Название магазина - произволное название Вашего магазина 
   * Уникальный идентификатор услуги ЕРИП – ID услуги в ЕРИП
   * Путь в дереве ЕРИП – По какому пути клиент должен искать выставленный счет
   * Логин – логин в системе ХуткiГрош.
   * Пароль – пароль в системе ХуткiГрош.
   * Sms оповещение - включить информирование клиента по смс при успешном выставлении счета (выполняется шлюзом Хуткiгрош)
   * Email оповещение - включить информирование клиента по email при успешном выставлении счета (выполняется шлюзом Хуткiгрош)
   * Статус заказа, если произошла ошибка выставления счета - какой статус присвоить заказу, если произошла ошибка выставления счета
   в ХуткiГрош (идентификатор из меню `Приложения — miniShop2 — Настройки - Статусы заказа`)
   * Статус заказа, если счет выставлен в ЕРИП  - какой статус присвоить заказу, если счет успешно выставлен в ХуткiГрош (идентификатор из меню `Приложения — miniShop2 — Настройки - Статусы заказа`)
   * Статус заказа, если счет оплачен в ЕРИП - какой статус присвоить заказу, когда ХуткiГрош проинформировал CMS о том,
   что счет успешно оплачен в ЕРИП (идентификатор из меню `Приложения — miniShop2 — Настройки - Статусы заказа`)
   * Статус заказа, если счет отменен в ЕРИП - какой статус присвоить заказу, когда ХуткiГрош проинформировал CMS о том,
   что счет по какой-то причине отменен в ЕРИП в ЕРИП (идентификатор из меню `Приложения — miniShop2 — Настройки - Статусы заказа`)
   * QR-код - если включена, то на итоговом экране клиенту отобразится способ оплаты QR-кодом (переход на pay.raschet.by)
   * Кнопка Webpay - если включена, то на итоговом экране клиенту отобразится кнопка для оплаты счета картой (переход на Webpay)
   * Срок действия счета - как долго счет, будет доступен в ЕРИП для оплаты          
   * Идентификатор ресурса при успехе - идентификатор ресурса, созданного в п.6
   * Идентификатор ресурса при ошибке - идентификатор ресурса, созданного в п.7

### Внимание!
Для автоматического обновления статуса заказа (после оплаты клиентом выставленного в ЕРИП счета) необходимо сообщить в службу технической поддержки сервиса «Хуткi Грош» адрес обработчика:
```
http://mydomen.my/modx/assets/components/minishop2/payment/hutkigrosh.php?action=notify
```

### Тестовые данные
Для настрой оплаты в тестовом режиме:
 * воспользуйтесь данными для подключения к тестовой системе, полученными при регистрации в ХуткiГрош
 * включите в настройках модуля "Режим песочницы" 
 * для эмуляции оплаты клиентом выставленного счета воспльзуйтесь личным кабинетом [тестовой системы](https://trial.hgrosh.by) (меню _Тест оплаты ЕРИП_)

_Разработано и протестировано с MODX Revolution 2.8.8-pt и minishop2-4.4.2-pl

### Разработка
1. Для удобства разработки отключить cache_lexicon_topics и cache_disabled
